# RUN-20260202 Tier A — DW-209 + DW-214 (0.1.9.241-analytics-mobile-window)

## Context

- **Date:** 2026-02-02
- **Tasks:**
  - **DW-209** — Analytics Overview mobile overflow + shadcn range selector + enable mobile pinch-zoom-out
  - **DW-214** — Analytics Temp Compensation: allow custom training window (start/end)
- **Goal:** Rebuild + refresh the installed controller (Tier A; no DB/settings reset) and confirm the Analytics pages work on mobile WebKit without layout regressions or client-side crashes.

## Preconditions (installed stack)

- Setup daemon health: `curl -fsS http://127.0.0.1:8800/healthz` → **ok**
- Core server health: `curl -fsS http://127.0.0.1:8000/healthz` → **ok**
- Pre-upgrade installed version: `0.1.9.240-highcharts-zooming-fix` (from `http://127.0.0.1:8800/api/status` → `farmctl status`)

## Build (controller bundle DMG)

- **Version:** `0.1.9.241-analytics-mobile-window`
- **Bundle path:** `/Users/Shared/FarmDashboardBuilds/FarmDashboardController-0.1.9.241-analytics-mobile-window.dmg`
- **Build log:** `/Users/Shared/FarmDashboardBuilds/logs/bundle-0.1.9.241-analytics-mobile-window.log`

Command:

```bash
mkdir -p /Users/Shared/FarmDashboardBuilds /Users/Shared/FarmDashboardBuilds/logs

cargo run --manifest-path apps/farmctl/Cargo.toml -- \
  bundle \
  --version 0.1.9.241-analytics-mobile-window \
  --output /Users/Shared/FarmDashboardBuilds/FarmDashboardController-0.1.9.241-analytics-mobile-window.dmg \
  --native-deps /usr/local/farm-dashboard/native \
  |& tee /Users/Shared/FarmDashboardBuilds/logs/bundle-0.1.9.241-analytics-mobile-window.log
```

## Refresh (upgrade installed controller)

Set bundle path:

```bash
curl -fsS -X POST http://127.0.0.1:8800/api/config \
  -H 'Content-Type: application/json' \
  -d '{"bundle_path":"/Users/Shared/FarmDashboardBuilds/FarmDashboardController-0.1.9.241-analytics-mobile-window.dmg"}'
```

Upgrade:

```bash
curl -fsS -X POST http://127.0.0.1:8800/api/upgrade
```

Post-upgrade installed version: `0.1.9.241-analytics-mobile-window` (from `http://127.0.0.1:8800/api/status` → `farmctl status`)

## Validation

- Installed smoke: `make e2e-installed-health-smoke` → **PASS**
- WebKit mobile evidence (Playwright iPhone 13 WebKit emulation):
  - Analytics Overview loads, and the sidebar remains mobile (hidden by default; overlay open/close works) without rendering the full desktop sidebar layout.
  - Temp Compensation loads, selecting a temperature reference sensor does not crash, and the Custom training window UI appears.

## Evidence

- WebKit sweep (captured + viewed):
  - `manual_screenshots_web/tier_a_0.1.9.241_dw209_pinchzoom_20260202_211214Z/analytics.png`
  - `manual_screenshots_web/tier_a_0.1.9.241_dw209_pinchzoom_20260202_211214Z/power.png`
  - `manual_screenshots_web/tier_a_0.1.9.241_dw209_pinchzoom_20260202_211214Z/mobile_nav_open.png`
- Temp Compensation custom-range evidence (captured + viewed):
  - `manual_screenshots_web/tier_a_0.1.9.241_dw214_comp_custom_range_20260202_211125Z/compensation_selected.png`
  - `manual_screenshots_web/tier_a_0.1.9.241_dw214_comp_custom_range_20260202_211125Z/compensation_custom_window.png`

## Notes

- `/analytics/*` exports a relaxed viewport (`minimum-scale=0.25`, `user-scalable=yes`) to allow pinch-zoom-out.
- Desktop layout breakpoints for the dashboard sidebar and Analytics multi-column grids are gated behind `@media (min-width: 1024px) and (pointer: fine)` so iOS pinch-zoom does not force the UI into desktop layout.

