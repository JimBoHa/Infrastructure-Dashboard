# RUN-20260205 Tier A — DW-220 (0.1.9.249-derived-builder-guardrails)

## Context

- **Date:** 2026-02-05
- **Task:** **DW-220** — Derived Sensor Builder: document derived-of-derived guardrails (depth/cycles)
- **Goal:** Refresh the installed controller (Tier A; no DB/settings reset) and confirm the Derived Sensor Builder UI clearly documents derived-of-derived constraints:
  - Cycles are rejected.
  - Max derived chain depth is 10.

## Preconditions (installed stack)

- Setup daemon health: `curl -fsS http://127.0.0.1:8800/healthz` → **ok**
- Core server health: `curl -fsS http://127.0.0.1:8000/healthz` → **ok**
- Pre-upgrade installed version: `0.1.9.248-derived-of-derived` (from `http://127.0.0.1:8800/api/status`)
- Rollback target (previous bundle):
  - `/Users/Shared/FarmDashboardBuilds/FarmDashboardController-0.1.9.248-derived-of-derived.dmg`

## Build (controller bundle DMG)

- **Version:** `0.1.9.249-derived-builder-guardrails`
- **Bundle path:** `/Users/Shared/FarmDashboardBuilds/FarmDashboardController-0.1.9.249-derived-builder-guardrails.dmg`
- **Build log:** `/Users/Shared/FarmDashboardBuilds/logs/bundle-0.1.9.249-derived-builder-guardrails.log`

Command:

```bash
mkdir -p /Users/Shared/FarmDashboardBuilds /Users/Shared/FarmDashboardBuilds/logs

cargo run --manifest-path apps/farmctl/Cargo.toml -- \
  bundle \
  --version 0.1.9.249-derived-builder-guardrails \
  --output /Users/Shared/FarmDashboardBuilds/FarmDashboardController-0.1.9.249-derived-builder-guardrails.dmg \
  --native-deps /usr/local/farm-dashboard/native \
  |& tee /Users/Shared/FarmDashboardBuilds/logs/bundle-0.1.9.249-derived-builder-guardrails.log
```

## Refresh (upgrade installed controller)

Set bundle path:

```bash
curl -fsS -X POST http://127.0.0.1:8800/api/config \
  -H 'Content-Type: application/json' \
  -d '{"bundle_path":"/Users/Shared/FarmDashboardBuilds/FarmDashboardController-0.1.9.249-derived-builder-guardrails.dmg"}'
```

Upgrade:

```bash
curl -fsS -X POST http://127.0.0.1:8800/api/upgrade
```

Post-upgrade installed version: `0.1.9.249-derived-builder-guardrails` (from `http://127.0.0.1:8800/api/status`)

## Validation

- Installed smoke: `make e2e-installed-health-smoke` → **PASS**

- UI validation:
  - Opened **Sensors & Outputs** → **Add sensor** → **Derived** and confirmed the Inputs description shows:
    - “Cycles are rejected.”
    - “Max chain depth: 10.”

## Evidence

- Screenshot (captured + viewed):
  - `manual_screenshots_web/tier_a_0.1.9.249-derived-builder-guardrails_dw220_20260205_104230Z/derived_builder_guardrails_note.png`
