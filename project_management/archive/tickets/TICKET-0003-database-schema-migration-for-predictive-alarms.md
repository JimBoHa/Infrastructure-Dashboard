Ticket: Database Schema Migration for Predictive Alarms
Title: [Task] Database Schema Migration to Support Predictive Alarm Metadata in infra/migrations
Description:
To support the storage of alarms generated by the new AI anomaly detection service, the database schema requires updates. The current alarm table structure is designed primarily for static threshold breaches. We need to extend this schema to distinguish between standard alarms and AI-predicted anomalies, as well as store the associated confidence metrics provided by the model.
Scope:
* Schema Extension: Create a new SQL migration file within infra/migrations to modify the existing alarms table.
* New Columns: Add fields to capture the alarm origin (e.g., distinguishing "threshold" vs. "anomaly_model") and a nullable field for the anomaly score/confidence level.
* Data Integrity: Ensure default values are applied to existing records so that current historical data remains valid and is classified as standard threshold alarms by default.
* Indexing: Review and update indexes if necessary to ensure queries filtering by "alarm type" remain performant on the dashboard.
Technical Context:
* The database is TimescaleDB.
* Migrations are managed in infra/migrations and applied locally via make migrate.
* Changes must be compatible with the apps/core-server ORM/data access layer updates being implemented in parallel.
Acceptance Criteria:
* make migrate successfully applies the new schema changes to a running local TimescaleDB instance without errors.
* The schema changes are non-destructive to existing alarm history.
* The apps/core-server can successfully insert a record containing the new metadata fields.
* The changes are captured in a version-controlled migration file consistent with existing conventions in the directory.
Notes for Developer:
* Coordinate with the core-server developer to agree on the exact column names and data types (e.g., FLOAT for scores vs DECIMAL) before finalizing the SQL.
* Verify that the migration includes necessary rollback logic or instructions in case of deployment failure.
