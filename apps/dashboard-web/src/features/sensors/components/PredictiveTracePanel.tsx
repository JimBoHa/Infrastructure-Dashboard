import type { PredictiveTraceEntry } from "@/types/alarms";
import CollapsibleCard from "@/components/CollapsibleCard";
import { Card } from "@/components/ui/card";

export default function PredictiveTracePanel({
  open,
  onToggle,
  loading,
  error,
  entries,
}: {
  open: boolean;
  onToggle: () => void;
  loading: boolean;
  error: string | null;
  entries: PredictiveTraceEntry[];
}) {
  return (
    <CollapsibleCard
      title={
        <span className="flex flex-col gap-0.5">
 <span className="text-xs font-semibold uppercase tracking-wide text-muted-foreground">
            Advanced
          </span>
          <span>Predictive model code trace</span>
        </span>
      }
      description="View the code generated by the predictive model and its sandbox output."
      open={open}
      onOpenChange={(next) => {
        if (next === open) return;
        onToggle();
      }}
    >
      {loading ? (
 <p className="text-sm text-muted-foreground">Loadingâ€¦</p>
      ) : null}
      {error ? <p className="text-sm text-rose-700">{error}</p> : null}
      {!loading && !error && !entries.length ? (
 <p className="text-sm text-muted-foreground">
          No recent predictive executions.
        </p>
      ) : null}
      {entries.length ? (
        <div className="mt-4 space-y-3">
          {entries.map((entry) => (
            <Card
              key={`${entry.timestamp}-${entry.code.slice(0, 16)}`}
              className="gap-0 bg-card-inset p-4"
            >
 <div className="flex flex-wrap items-center gap-2 text-xs text-muted-foreground">
 <span className="inline-flex items-center rounded-full bg-indigo-50 px-2.5 py-0.5 text-xs font-semibold text-indigo-700">
                  {entry.model ?? "model"}
                </span>
 <span className="inline-flex items-center rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold text-foreground">
                  {new Date(entry.timestamp).toLocaleString()}
                </span>
              </div>
              <div className="mt-3 grid gap-2 lg:grid-cols-2 lg:gap-4">
                <div>
 <p className="text-xs font-semibold uppercase tracking-wide text-muted-foreground">
                    Code
                  </p>
 <pre className="mt-1 max-h-60 overflow-auto rounded-lg bg-neutral-900 px-3 py-2 text-xs text-neutral-100">
                    {entry.code}
                  </pre>
                </div>
                <div>
 <p className="text-xs font-semibold uppercase tracking-wide text-muted-foreground">
                    Output
                  </p>
 <pre className="mt-1 max-h-60 overflow-auto rounded-lg bg-white px-3 py-2 text-xs text-foreground">
                    {entry.output}
                  </pre>
                </div>
              </div>
            </Card>
          ))}
        </div>
      ) : null}
    </CollapsibleCard>
  );
}
